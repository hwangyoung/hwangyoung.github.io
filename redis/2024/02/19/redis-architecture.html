<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="google-translate-customization" content="108d9124921d80c3-80e20d618ff053c8-g4f02ec6f3dba68b7-c">
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Redis Architecture | Young’s Logs</title>
<meta name="generator" content="Jekyll v4.3.3">
<meta property="og:title" content="Redis Architecture">
<meta name="author" content="Young Hwang">
<meta property="og:locale" content="en_US">
<meta name="description" content="Redis Architecture">
<meta property="og:description" content="Redis Architecture">
<link rel="canonical" href="/redis/2024/02/19/redis-architecture.html">
<meta property="og:url" content="/redis/2024/02/19/redis-architecture.html">
<meta property="og:site_name" content="Young’s Logs">
<meta property="og:type" content="article">
<meta property="article:published_time" content="2024-02-19T00:00:00+00:00">
<meta name="twitter:card" content="summary">
<meta property="twitter:title" content="Redis Architecture">
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"Young Hwang"},"dateModified":"2024-02-19T00:00:00+00:00","datePublished":"2024-02-19T00:00:00+00:00","description":"Redis Architecture","headline":"Redis Architecture","mainEntityOfPage":{"@type":"WebPage","@id":"/redis/2024/02/19/redis-architecture.html"},"url":"/redis/2024/02/19/redis-architecture.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="icon" href="">
  <link rel="canonical" href="">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-noto-sans@0.0.72/index.min.css">
  <link rel="stylesheet" href="/assets/css/main.css">
  <script src="/assets/js/main.js"></script><link type="application/atom+xml" rel="alternate" href="/feed.xml" title="Young's Logs">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/styles/default.min.css">
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/highlight.min.js"></script>
<!-- and it's easy to individually load additional languages -->
<script charset="UTF-8" src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.1.1/languages/go.min.js" async></script>



















<script>
// Init highlight js
document.addEventListener('DOMContentLoaded', function(event) {
  var els = document.querySelectorAll('pre code')

  function addLangData(block) {
    var outer = block.parentElement.parentElement.parentElement;
    var lang = block.getAttribute('data-lang');
    for (var i = 0; i < outer.classList.length; i++) {
      var cls = outer.classList[i];
      if (cls.startsWith('language-')) {
        lang = cls;
        break;
      }
    }
    if (!lang) {
      cls = block.getAttribute('class');
      lang = cls ? cls.replace('hljs ', '') : '';
    }
    if (lang.startsWith('language-')) {
      lang = lang.substr(9);
    }
    block.setAttribute('class', 'hljs ' + lang);
    block.parentNode.setAttribute('data-lang', lang);
  }

  function addBadge(block) {
    var enabled = ('true' || 'true').toLowerCase();
    if (enabled == 'true') {
      var pre = block.parentElement;
      pre.classList.add('badge');
    }
  }

  function handle(block) {
    addLangData(block);
    addBadge(block)
    hljs.highlightBlock(block);
  }

  for (var i = 0; i < els.length; i++) {
    var el = els[i];
    handle(el);
  }
});
</script>

<style>
  /* code language badge */
  pre.badge::before {
    content: attr(data-lang);
    color: #fff;
    background-color: #ff4e00;
    padding: 0 .5em;
    border-radius: 0 2px;
    text-transform: uppercase;
    text-align: center;
    min-width: 32px;
    display: inline-block;
    position: absolute;
    right: 0;
  }

  /* fix wrong badge display for firefox browser */
  code > table pre::before {
    display: none;
  }
</style>
<script src="//cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.7/umd/photoswipe-lightbox.umd.min.js" async></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.7/umd/photoswipe.umd.min.js" async></script>
<link href="//cdnjs.cloudflare.com/ajax/libs/photoswipe/5.3.7/photoswipe.min.css" rel="stylesheet">
<style>
  .pswp .pswp__container .pswp__img {
    background-color: white;
  }
</style>

<script>
  function initPhotoSwipe() {
    let customOptions = {};

    try {
      const data = ``.replaceAll("=>", ":");
      customOptions = JSON.parse(data);
    } catch (e) {
      console.info("Invalid custom photo previewer options! " + e.message);
    }

    // Define object and gallery options
    const options = Object.assign(
      {
        gallery: "section.main",
        children: "a.photo-swipe",
        photo_scale: 2,
        // dynamic import is not supported in UMD version
        pswpModule: PhotoSwipe,
      },
      customOptions
    );

    const galleryEl = document.querySelector(options.gallery);
    if (!galleryEl) {
      return;
    }

    const imgEls = [];
    const els = galleryEl.querySelectorAll("img:not(.emoji)");
    els.forEach((el) => {
      if (el.src.trim() == "") {
        return;
      }
      if (!imgEls.includes(el)) {
        imgEls.push(el);
      }
    });

    if (imgEls.length === 0) {
      return;
    }

    imgEls.forEach((imgEl) => {
      imgEl.outerHTML = `
      <a class="photo-swipe"
        href="${imgEl.src}"
        data-pswp-width="${
          Math.max(imgEl.naturalWidth, imgEl.width) * options.photo_scale
        }"
        data-pswp-height="${
          Math.max(imgEl.naturalHeight, imgEl.height) * options.photo_scale
        }"
        data-pswp-caption="${imgEl.getAttribute("caption") || imgEl.alt}"
        target="_blank">
        ${imgEl.outerHTML}
      </a>`;
    });

    // Initialize PhotoSwipe 5
    var lightbox = new PhotoSwipeLightbox(options);

    lightbox.init();
  }

  window.addEventListener("load", initPhotoSwipe);
</script>
</head>
<body>



























































































































<header class="site-header " role="banner">

  <div class="wrapper">
    <div class="site-header-inner">
<span class="site-brand"><a class="site-brand-inner" rel="author" href="/">
  <img class="site-favicon" title="Young's Logs" src="" onerror="this.style.display='none'">
  Young's Logs
</a>
</span><nav class="site-nav">
          <input type="checkbox" id="nav-trigger" class="nav-trigger">
          <label for="nav-trigger">
            <span class="menu-icon">
              <svg viewbox="0 0 18 15" width="18px" height="15px">
                <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"></path>
              </svg>
            </span>
          </label>

          <div class="trigger">
<a class="page-link" href="/about.html">ABOUT</a><a class="page-link" href="/archives.html">ARCHIVES</a><a class="page-link" href="/categories.html">CATEGORIES</a><a class="page-link" href="/">HOME</a><a class="page-link" href="/tags.html">TAGS</a>









<div class="page-link" style="display: inline;">



<div id="google_translate_element" style="display: none;">
</div>

<div class="ct-language">
  <ul class="list-unstyled ct-language-dropdown">
    
      <li>
        <a href="#" class="lang-select" data-lang="en">
          
          <img src="https://cdn.countryflags.com/thumbs/united-states-of-america/flag-400.png" title="English">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="fr">
          
          <img src="https://cdn.countryflags.com/thumbs/france/flag-400.png" title="French">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="zh-CN">
          
          <img src="https://cdn.countryflags.com/thumbs/china/flag-400.png" title="Chinese(Simple)">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ja">
          
          <img src="https://cdn.countryflags.com/thumbs/japan/flag-400.png" title="Japanese">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ko">
          
          <img src="https://cdn.countryflags.com/thumbs/south-korea/flag-400.png" title="Korean">
          
        </a>
      </li>
    
      <li>
        <a href="#" class="lang-select" data-lang="ru">
          
          <img src="https://cdn.countryflags.com/thumbs/russia/flag-400.png" title="Russian">
          
        </a>
      </li>
    
  </ul>
</div>

<script type="text/javascript">
function googleTranslateElementInit() {
  new google.translate.TranslateElement({
    pageLanguage: 'en',
    autoDisplay: false,
    layout: google.translate.TranslateElement.InlineLayout.VERTICAL
  }, 'google_translate_element');

  // Links to cross-origin destinations are unsafe
  var gll = document.getElementsByClassName('goog-logo-link')[0];
  if (gll) {
    gll.setAttribute('rel', 'noopener');
  }

  function restoreLang() {
    var iframe = document.getElementsByClassName('goog-te-banner-frame')[0];
    if (!iframe) return;

    var innerDoc = iframe.contentDocument || iframe.contentWindow.document;
    var restore_el = innerDoc.getElementsByTagName("button");

    for (var i = 0; i < restore_el.length; i++) {
      if (restore_el[i].id.indexOf("restore") >= 0) {
        restore_el[i].click();
        var close_el = innerDoc.getElementsByClassName("goog-close-link");
        close_el[0].click();
        return;
      }
    }
  }

  function triggerHtmlEvent(element, eventName) {
    var event;
    if (document.createEvent) {
      event = document.createEvent('HTMLEvents');
      event.initEvent(eventName, true, true);
      element.dispatchEvent(event);
    } else {
      event = document.createEventObject();
      event.eventType = eventName;
      element.fireEvent('on' + event.eventType, event);
    }
  }

  var googleCombo = document.querySelector("select.goog-te-combo");
  var langSelect = document.querySelector('.ct-language');
  langSelect.addEventListener('click', function(event) {
    if (!event.target) {
      return;
    }

    var selected = document.querySelector('.ct-language .ct-language-selected');
    if (selected) {
      selected.classList.remove('ct-language-selected');
    }

    var target = event.target;
    while (target && target !== langSelect ) {
      if (target.matches('.lang-select')) {
        break;
      }
      target = target.parentElement;
    }

    if (target && target.matches('.lang-select')) {
      var lang = target.getAttribute('data-lang');
      if (googleCombo.value == lang) {
        restoreLang();
      } else {
        target.parentElement.classList.add('ct-language-selected');
        googleCombo.value = lang;
        triggerHtmlEvent(googleCombo, 'change');
      }
    }

    event.preventDefault();
  });
}
</script>

<script type="text/javascript" src="https://translate.google.com/translate_a/element.js?cb=googleTranslateElementInit" async></script>
</div>
</div>
        </nav>
</div>
  </div>
</header>

<script>
  function initHeader() {
    var lastScrollY = getScrollPos().y;
    var documentElement = document.documentElement;

    function storeScrollData() {
      var y = getScrollPos().y;var scrollStatus = "";

      if (y <= 0) {
        scrollStatus = "top";
      } else if ((window.innerHeight + y) >= document.body.offsetHeight) {
        scrollStatus = "bottom";
      } else {
        var isScrollDown = (y - lastScrollY > 0) ? true : false;
        scrollStatus = isScrollDown ? "down" : "up";
      }

      lastScrollY = y;
      documentElement.setAttribute("data-scroll-status", scrollStatus);
    }

    window.addEventListener('scroll', function(e) {
      storeScrollData();
    });

    storeScrollData();
  }
  document.addEventListener('DOMContentLoaded', initHeader);
</script>
















































































































































<script>
  function hashLocate(hashValue) {
    hashValue = hashValue.replace(/^.*#h-/, '');
    hashValue = decodeURIComponent(hashValue);
    var element = document.getElementById(hashValue);

    if (!element) {
      return;
    }

    var header = document.querySelector('header.site-header');
    var headerRect = header.getBoundingClientRect();
    var headerTop = Math.floor(headerRect.top);
    var headerHeight = Math.floor(headerRect.height);
    var scrollPos = getScrollPos();
    var offsetY = element.offsetTop - (headerTop + headerHeight + 20);

    if (offsetY == scrollPos.y) {
      return;
    }

    if (headerTop == 0  && offsetY > scrollPos.y) {
      offsetY += headerHeight + 2;
    } else if (headerTop < 0  && offsetY < scrollPos.y) {
      offsetY -= headerHeight - 2;
    }

    smoothScrollTo(offsetY);
  }

  // The first event occurred
  window.addEventListener('load', function(event) {
    if (window.location.hash) {
      hashLocate(window.location.hash);
    }
  });

  // The first event occurred
  window.addEventListener('click', function(event) {
    if (event.target.tagName.toLowerCase() == 'a') {
      hashLocate(event.target.getAttribute('href'));
    }
  });
</script>
<div class="theme-toggle">
  <input type="checkbox" id="theme-switch">
  <label for="theme-switch">
    <div class="toggle"></div>
    <div class="names">
      <p class="light">Light</p>
      <p class="dark">Dark</p>
    </div>
  </label>
</div>




<script>
  (function() {
    var sw = document.getElementById('theme-switch');
    var html = document.getElementsByTagName('html')[0];
    var nightModeOption = ('auto' || 'auto').toLowerCase();
    var storage = nightModeOption === 'manual'
        ? localStorage
        : sessionStorage;
    var themeData = loadThemeData();

    function saveThemeData(data) {
      storage.setItem('theme', JSON.stringify(data));
    }

    function loadThemeData() {
      var data = storage.getItem('theme');
      try {
        data = JSON.parse(data ? data : '');
      } catch(e) {
        data = { nightShift: undefined, autoToggleAt: 0 };
        saveThemeData(data);
      }
      return data;
    }

    function handleThemeToggle(nightShift) {
      themeData.nightShift = nightShift;
      saveThemeData(themeData);
      html.dataset.theme = nightShift ? 'dark' : 'light';
      setTimeout(function() {
        sw.checked = nightShift ? true : false;
      }, 50);
    }

    function autoThemeToggle() {
      // Next time point of theme toggle
      var now = new Date();
      var toggleAt = new Date();
      var hours = now.getHours();
      var nightShift = hours >= 19 || hours <=7;

      if (nightShift) {
        if (hours > 7) {
          toggleAt.setDate(toggleAt.getDate() + 1);
        }
        toggleAt.setHours(7);
      } else {
        toggleAt.setHours(19);
      }

      toggleAt.setMinutes(0);
      toggleAt.setSeconds(0);
      toggleAt.setMilliseconds(0)

      var delay = toggleAt.getTime() - now.getTime();

      // auto toggle theme mode
      setTimeout(function() {
        handleThemeToggle(!nightShift);
      }, delay);

      return {
        nightShift: nightShift,
        toggleAt: toggleAt.getTime()
      };
    }

    // Listen the theme toggle event
    sw.addEventListener('change', function(event) {
      handleThemeToggle(event.target.checked);
    });

    if (nightModeOption == 'auto') {
      var data = autoThemeToggle();

      // Toggle theme by local setting
      if (data.toggleAt > themeData.autoToggleAt) {
        themeData.autoToggleAt = data.toggleAt;
        handleThemeToggle(data.nightShift);
      } else {
        handleThemeToggle(themeData.nightShift);
      }
    } else if (nightModeOption == 'manual') {
      handleThemeToggle(themeData.nightShift);
    } else {
      var nightShift = themeData.nightShift;
      if (nightShift === undefined) {
        nightShift = nightModeOption === 'on';
      }
      handleThemeToggle(nightShift);
    }
  })();
</script>
<div id="click-to-top" class="click-to-top">
  <i class="fa fa-arrow-up"></i>
</div>
<script>
  (function () {
    const clickToTop = document.getElementById('click-to-top');
    window.addEventListener('scroll', () => {
      if (window.scrollY > 100) {
        clickToTop.classList.add('show')
      }else {
        clickToTop.classList.remove('show')
      }
    });
    clickToTop.addEventListener('click', () => {
      window.smoothScrollTo(0);
    });
  })();
</script>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <div class="framework">
  <section class="main">

     <div class="post">
  <section>









<header class="post-header">
  <h1 class="post-title p-name" itemprop="name headline">Redis Architecture</h1>
  <h2 class="post-subtitle"></h2>

  <div class="post-meta">
    <time class="dt-published" datetime="2024-02-19T00:00:00+00:00" itemprop="datePublished"><i class="fa fa-calendar"></i> Feb 19, 2024
    </time>
    
































    <span class="post-reading-time left-vsplit"><i class="fa fa-clock-o"></i> About 5 mins</span>
  </div>
<div class="post-tags">
<a class="post-tag" href="/tags.html#redis">#redis</a><a class="post-tag" href="/tags.html#architecture">#architecture</a>
</div></header>
<article class="post h-entry" itemscope itemtype="http://schema.org/BlogPosting">

    <div class="post-content e-content" itemprop="articleBody">

      <h2 id="redis-architecture">Redis Architecture</h2>

<p>아래의 그림은 Redis 서버의 기본 아키텍처(Redis Standalone Architecture) 구조이며 3가지 영역으로 구성되어 있습니다.</p>

<p><img class="mermaid" src="https://mermaid.ink/svg/eyJjb2RlIjoiZmxvd2NoYXJ0IExSXG5zdWJncmFwaCBcIkRhdGEgU3RydWN0dXJlXCJcbmExW1wiUmVzaWRlbnQgQXJlYVxuKFdvcmtpbmdTZXQpXCJdXG5zdWJncmFwaCBtZW1vcnlcbmIxW2FkaXN0XVxuYjJbZGljdF1cbmIzW3Nkc11cbmI0W3ppcG1hcF1cbmVuZFxuZW5kXG5pZDAoW1wiQ2xpZW50IFByb2Nlc3NcbihyZWRpcy1jbGkuZXhlKVwiXSlcbmlkMShbXCJTdWItVGhyZWFkIDJcbkJJTy1BT0YtUkVTVk5DXCJdKVxuaWQyKFtcIlN1Yi1UaHJlYWQgMVxuQklPLUNMT1NFLUZJTEVcIl0pXG5pZDMoW1wiU3ViLVRocmVhZCAzXG5CSU8tQU9GLVJFU1ZOQ1wiXSlcbmlkNChbXCJTZXJ2ZXIgcHJvY2Vzc1xuKE1haW4gVGhyZWFkKVwiXSlcbmExIDwtLT4gaWQwXG5hMSA8LS0-IGlkMVxuaWQxIDwtLT4gZGIxXG5hMSA8LS0-IG1lbW9yeVxubWVtb3J5IDwtLT4gaWQyXG5pZDIgPC0tPiBkYjFcbm1lbW9yeSA8LS0-IGlkM1xubWVtb3J5IDwtLT4gaWQ0XG5pZDMgPC0tPiBkYjJcbmlkNCA8LS0-IGRiMlxuZGIxWyhBb2YgRmlsZSldXG5kYjJbKER1bXAgRmlsZSldIiwibWVybWFpZCI6eyJ0aGVtZSI6ImRlZmF1bHQifX0"></p>

<ul>
  <li>Memory 영역</li>
  <li>File 영역</li>
  <li>Process 영역</li>
</ul>

<ol>
  <li>Memory 영역</li>
</ol>

<ul>
  <li>
    <p>Resident Area</p>

    <p>사용자가 Redis 서버에 접속해서 처리하는 모든 데이터가 가장 먼저 저장되는 영역입니다.
실제 작업이 수행되는 공간이고 WorkingSet 영역이라고 표현합니다.</p>
  </li>
  <li>
    <p>Data Structure</p>

    <p>Redis 서버를 운영하다 보면 발생하는 다양한 정보와 서버 서버 상태를 모니터링하기 위해 수집한 상태 정보를 저장하고 관리하기 위한 메모리 공간이 필요합니다.
이러한 정보들은 Redis 서버의 메모리 영역에 저장되며, 이러한 정보들을 Data Structure 라고 표현합니다.</p>
  </li>
</ul>

<ol>
  <li>File 영역</li>
</ol>

<ul>
  <li>
    <p>AOF(Append Only File)</p>

    <p>Redis는 모든 데이터를 메모리 상에 저장하고 관리하는 In-Memory 기반의 데이터 처리 기술을 제공합니다.
하지만 중요한 데이터의 경우 사용자의 필요에 따라 지속적으로 저장해야 할 필요가 있는데 이를 위해 제공되느 디스크 영역이 AOF(Append Only File) 입니다.(스냅샷 데이터)</p>
  </li>
  <li>
    <p>DUMP File</p>

    <p>AOF 파일과 같이 사용자 데이터를 디스크 상에 저장할 수 있지만 소량의 데이터를 일시적으로 저장할 때 사용하는 파일입니다.</p>
  </li>
</ul>

<ol>
  <li>Process 영역</li>
</ol>

<ul>
  <li>
    <p>Server Process</p>

    <p>redis-server.exe 또는 redis-sentinel.exe 실행 코드에 의해 활성화되는 프로세스를 서버 프로세스라고 하며 Redis 인스턴스를 관리해 주며 사용자가 요구한 작업을 수행하는 프로세스 입니다.
Redis Server 프로세스는 4개의 멀티 쓰레드로 구성되는데 main thread, sub thread 1(BIO-Close-File), sub thread 2(BIO-AOF-Resync), sub thread 3(BIO-Lazy-Free)로 구성되어 있습니다.</p>
  </li>
  <li>
    <p>Client Process</p>

    <p>redis-cli.exe 또는 사용자 애플리케이션에 의해 실행되는 명령어를 실행하기 위해 제공되는 프로세스 입니다.</p>
  </li>
</ul>

<h1 id="redis-memory-확인">Redis Memory 확인</h1>

<p>Redis 서버의 메모리 사용량을 확인하기 위해서는 redis-cli를 실행하고 다음과 같은 명령어를 입력하면 됩니다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>redis-cli <span class="nt">-p</span> 5000

<span class="o">&gt;</span> info memory
used_memory:29261104 
used_memory_human:27.91M &lt;- Redis 서버가 현재 사용하고 있는 전체 메모리<span class="o">(</span>used_memory_overhead + used_memory_dataset<span class="o">)</span>
used_memory_rss:42463232
used_memory_rss_human:40.50M &lt;- Redis 서버가 사용중인 실제 메모리 크기<span class="o">(</span>RSS, Resident Set Size<span class="o">)</span>
used_memory_peak:29276336
used_memory_peak_human:27.92M &lt;- Redis 서버의 이전에 가장 많이 사용했던 메모리 최대치
used_memory_peak_perc:99.95% &lt;- Redis 서버가 시작된 이후 가장 많이 사용했던 메모리 대비 현재 사용 중인 메모리의 비율을 퍼센트로 표현
used_memory_overhead:1379680 &lt;- Redis 서버가 동작하기 위해 필요한 메모리<span class="o">(</span>byte<span class="o">)</span>
used_memory_startup:898744 &lt;- 최초 할당 되었던 메모리 크기<span class="o">(</span>byte<span class="o">)</span>
used_memory_dataset:27881424 &lt;- 사용자 데이터가 저장된 메모리 크기<span class="o">(</span>byte<span class="o">)</span>
used_memory_dataset_perc:98.30% &lt;- Redis 서버에서 사용자 데이터를 저장하는데 사용하는 메모리가 전체 사용 메모리<span class="o">(</span>used_memory<span class="o">)</span> 대비 차지하는 비율을 퍼센트로 표현
allocator_allocated:30833208 &lt;- Redis 서버가 메모리 할당자로부터 할당받은 메모리의 총량<span class="o">(</span>byte<span class="o">)</span>
allocator_active:38207488 &lt;- Redis 서버가 메모리 할당자로부터 실제로 할당받아 현재 활성화된 메모리의 총량<span class="o">(</span>byte<span class="o">)</span>
allocator_resident:40632320 &lt;- Redis 서버가 메모리 할당자로부터 할당받아서 시스템에 의해 실제로 사용되고 있는 메모리의 총룡<span class="o">(</span>byte<span class="o">)</span>
total_system_memory:8222203904  
total_system_memory_human:7.66G &lt;- Redis 서버가 실행되고 있는 시스템의 총 메모리 크기
used_memory_lua:31744 
used_memory_vm_eval:31744 &lt;- Redis 서버에서 Lua 스크립트를 평가<span class="o">(</span>evaluate<span class="o">)</span>하는 데 사용되는 메모리의 양
used_memory_lua_human:31.00K &lt;- Redis 서버에서 Lua 스크립트 엔진이 사용하는 메모리의 양<span class="o">(</span>byte<span class="o">)</span>
used_memory_scripts_eval:0 &lt;- Redis 서버에서 Lua 스크립트를 평가<span class="o">(</span>evaluate<span class="o">)</span>하는 데 사용되는 메모리의 양
number_of_cached_scripts:0
number_of_functions:0
number_of_libraries:0
used_memory_vm_functions:32768
used_memory_vm_total:64512
used_memory_vm_total_human:63.00K
used_memory_functions:184
used_memory_scripts:184
used_memory_scripts_human:184B
maxmemory:0
maxmemory_human:0B &lt;- Redis 설정에서 사용할 수 있는 최대 메모리 크기, 0이면 제한 없음, 0이 아닌 경우 maxmemory-policy에 따라 메모리를 관리 
maxmemory_policy:noeviction &lt;<span class="nt">-Redis</span> 설정에서 메모리가 maxmemory로 설정된 값에 도달했을 때 어떻게 처리할지를 결정하는 설정 
allocator_frag_ratio:1.24
allocator_frag_bytes:7374280
allocator_rss_ratio:1.06
allocator_rss_bytes:2424832
rss_overhead_ratio:1.05
rss_overhead_bytes:1830912
mem_fragmentation_ratio:1.45 &lt;<span class="nt">-Redis</span> 서버의 메모리 파편화 비율 
mem_fragmentation_bytes:13202328
mem_not_counted_for_evict:0
mem_replication_backlog:0
mem_total_replication_buffers:0
mem_clients_slaves:0
mem_clients_normal:22400
mem_cluster_links:0
mem_aof_buffer:0
mem_allocator:jemalloc-5.3.0
active_defrag_running:0
lazyfree_pending_objects:0
lazyfreed_objects:0
</code></pre></div></div>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// 실시간 사용 중인 메모리 크기 확인
<span class="nv">$ </span>redis-cli <span class="nt">-p</span> 5000 <span class="nt">-r</span> 100 <span class="nt">-i</span> 1 info | <span class="nb">grep </span>used_memory_human:
used_memory_human:27.91M
used_memory_human:27.91M
...
^C // Ctrl + C 중단
</code></pre></div></div>

<p>메모리 영역에 대한 HIT와 MISSES에 대한 확인은 다음과 같이 확인할 수 있습니다.</p>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>redis-cli <span class="nt">-p</span> 5000

<span class="o">&gt;</span> info stats
<span class="c"># Stats</span>
total_connections_received:2
total_commands_processed:25
instantaneous_ops_per_sec:5
total_net_input_bytes:732
total_net_output_bytes:7785
total_net_repl_input_bytes:0
total_net_repl_output_bytes:0
instantaneous_input_kbps:0.17
instantaneous_output_kbps:1.89
instantaneous_input_repl_kbps:0.00
instantaneous_output_repl_kbps:0.00
rejected_connections:0
sync_full:0
sync_partial_ok:0
sync_partial_err:0
expired_keys:0
expired_stale_perc:0.00
expired_time_cap_reached_count:0
expire_cycle_cpu_milliseconds:2172
evicted_keys:0
evicted_clients:0
total_eviction_exceeded_time:0
current_eviction_exceeded_time:0
keyspace_hits:0 &lt;- Redis에서 키 조회 요청이 성공한 횟수, 값이 높을수록 Redis에서 데이터 조회가 빈번하게 성공하고 있다는 것을 의미
keyspace_misses:0 &lt;<span class="nt">-Redis</span>에서 키 조회 요청이 실패한 횟수, 값이 높을수록 Redis에서 데이터 조회가 빈번하게 실패하고 있다는 것을 의미
pubsub_channels:0
pubsub_patterns:0
pubsubshard_channels:0
latest_fork_usec:0
total_forks:0
migrate_cached_sockets:0
slave_expires_tracked_keys:0
active_defrag_hits:0
active_defrag_misses:0
active_defrag_key_hits:0
active_defrag_key_misses:0
total_active_defrag_time:0
current_active_defrag_time:0
tracking_total_keys:0
tracking_total_items:0
tracking_total_prefixes:0
unexpected_error_replies:0
total_error_replies:0
dump_payload_sanitizations:0
total_reads_processed:25
total_writes_processed:23
io_threaded_reads_processed:0
io_threaded_writes_processed:0
reply_buffer_shrinks:3
reply_buffer_expands:1
eventloop_cycles:138785
eventloop_duration_sum:34076667
eventloop_duration_cmd_sum:711
instantaneous_eventloop_cycles_per_sec:13
instantaneous_eventloop_duration_usec:222
acl_access_denied_auth:0
acl_access_denied_cmd:0
acl_access_denied_key:0
acl_access_denied_channel:0
</code></pre></div></div>

<p>Redis 서버 프로세스와 쓰레드 구조를 모니터링하는 방법입니다.
Redis 서버 프로세스는 4개의 멀티 쓰레드로 구성되며 각 쓰레드의 역할은 다음과 같습니다.</p>

<ol>
  <li>
    <p>Main Thread
  Redis 서버에 수행되는 대부분의 명령어와 이벤트를 처리하는 역할을 수행합니다.</p>
  </li>
  <li>
    <p>Sub-Thread 1(BIO-Close-File)
  쓰레드 1은 AOF(Append Only File)에 데이터를 Rewrite 할 때 기존 파일은 Close하고 새로운 AOF 파일에 Write하는 역할을 수행합니다.</p>
  </li>
  <li>
    <p>Sub-Thread 2(BIO-AOF-Resync)
  쓰레드 2는 AOF 쓰기 작업을 수행할 때 사용됩니다.</p>
  </li>
  <li>
    <p>Sub-Thread 3(BIO-Lazy-Free)
  쓰레드3은 UNLINK, FLUSHALL, FLUSHDB 명령어를 수행할 때 빠른 성능을 보장하기 위해 백그라운드에서 실행 됩니다.</p>
  </li>
</ol>

<div class="language-shell highlighter-rouge"><div class="highlight"><pre class="highlight"><code>// redis multi-thread 확인
<span class="nv">$ </span>ps <span class="nt">-eLF</span> | <span class="nb">grep </span>redis

// system call 확인
<span class="nv">$ </span>strace <span class="nt">-p</span> 16310
</code></pre></div></div>

<h2 id="system-사양">System 사양</h2>

<table>
  <thead>
    <tr>
      <th style="text-align: center">내용</th>
      <th style="text-align: center">최소 사양</th>
      <th style="text-align: center">권장 사양</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: center">
<h1 id="of-node-per-cluster">of node per cluster</h1>
</td>
      <td style="text-align: center">2 Cores</td>
      <td style="text-align: center">
<blockquote>
  <p>= 3 Cores</p>
</blockquote>
</td>
    </tr>
    <tr>
      <td style="text-align: center">
<h1 id="of-cores-per-node">of cores per node</h1>
</td>
      <td style="text-align: center">3 Cores</td>
      <td style="text-align: center">
<blockquote>
  <p>= 8 Cores</p>
</blockquote>
</td>
    </tr>
    <tr>
      <td style="text-align: center">RAM</td>
      <td style="text-align: center">15GB</td>
      <td style="text-align: center">
<blockquote>
  <p>= 30GB</p>
</blockquote>
</td>
    </tr>
    <tr>
      <td style="text-align: center">Storage</td>
      <td style="text-align: center">SATA(RAM 크기 * 10)</td>
      <td style="text-align: center">40GB</td>
    </tr>
    <tr>
      <td style="text-align: center">Persistentce Storage</td>
      <td style="text-align: center">RAM 크기 * 3</td>
      <td style="text-align: center">
<blockquote>
  <p>= RAM 크기 * 6 \n (&gt;= RAM + Flash * 5)</p>
</blockquote>
</td>
    </tr>
    <tr>
      <td style="text-align: center">Network</td>
      <td style="text-align: center">1G</td>
      <td style="text-align: center">
<blockquote>
  <p>= 10G</p>
</blockquote>
</td>
    </tr>
  </tbody>
</table>

<p>서버의 사양을 어떻게 결정할 것인가?</p>

<h2 id="노드-수-of-node-per-cluster">노드 수(# of node per cluster)</h2>

<p>하나의 standalone 서버를 구축하는 경우에 master 서버 1대, slave 서버 1대 그리고 FailOver와 Load Balancing을 위한 Sentinel 서버 1대를 구축하는 경우 최소 3대의 서버가 요구 됩니다.</p>


    </div>

</article>
<div class="post-nav">
<a class="previous" href="/redis/2024/02/16/redis-data-model.html" title="Redis Data Model">Redis Data Model</a><a class="next" href="/java/2024/03/01/java-java-17-features.html" title="Java 17 Features">Java 17 Features</a>
</div>
<div class="post-related">
      <div>Related Articles</div>
      <ul>
        <li class="">
          <a class="post-link" href="/spring/2023/09/11/spring-exception-handle.html" title="Spring MVC에서 exception handling 하기-01">
            Spring MVC에서 exception handling 하기-01<span class="post-badges">
  <span class="post-badge badge-top">TOP</span>
  <span class="post-badge badge-new">NEW</span>
</span>
</a>
        </li>
<li class="">
          <a class="post-link" href="/database/2016/08/18/database-oracle-database-system-tables-and-views.html" title="System Tables and Views">
            System Tables and Views<span class="post-badges">
  <span class="post-badge badge-top">TOP</span>
  <span class="post-badge badge-new">NEW</span>
</span>
</a>
        </li>
<li class="">
          <a class="post-link" href="/java/2021/04/13/java-static-Initializer-block.html" title="Initializer Block(초기화 블럭) 의 이해">
            Initializer Block(초기화 블럭) 의 이해<span class="post-badges">
  <span class="post-badge badge-top">TOP</span>
  <span class="post-badge badge-new">NEW</span>
</span>
</a>
        </li>
<li class="">
          <a class="post-link" href="/redis/2024/02/16/redis-data-model.html" title="Redis Data Model">
            Redis Data Model<span class="post-badges">
  <span class="post-badge badge-top">TOP</span>
  <span class="post-badge badge-new">NEW</span>
</span>
</a>
        </li>
</ul>
    </div>
<div class="post-comments"></div></section>
</div>


  </section>
  <section class="sidebar" style="margin-left: 15px;">
    <!-- Get sidebar items --><style type="text/css" media="screen">
.post-menu ul {
  list-style: none;
  padding: 0;
  margin: 0;
}
</style>

<div class="post-menu">
  <div class="post-menu-title">TOC</div>
  <div class="post-menu-content"></div>
</div>

<script>
  function generateContent() {
    var menu = document.querySelector(".post-menu");
    var menuContent =  menu.querySelector(".post-menu-content");
    var headings = document.querySelector(".post-content").querySelectorAll("h2, h3, h4, h5, h6");

    // Hide menu when no headings
    if (headings.length === 0) {
      return menu.style.display = "none";
    }

    // Generate post menu
    var menuHTML = '';
    for (var i = 0; i < headings.length; i++) {
      var h = headings[i];
      menuHTML += (
        '<li class="h-' + h.tagName.toLowerCase() + '">'
        + '<a href="#h-' + h.getAttribute('id') + '">' + h.textContent + '</a></li>');
    }

    menuContent.innerHTML = '<ul>' + menuHTML + '</ul>';

    // The header element
    var header = document.querySelector('header.site-header');

    function doMenuCollapse(index, over_items) {
      var items = menuContent.firstChild.children;

      if (over_items == undefined) {
        over_items = 20;
      }

      if (items.length < over_items) {
        return;
      }

      var activeItem = items[index];
      var beginItem = activeItem
      var endItem = activeItem
      var beginIndex = index;
      var endIndex = index + 1;
      while (beginIndex >= 0
        && !items[beginIndex].classList.contains('h-h2')) {
        beginIndex -= 1;
      }
      while (endIndex < items.length
        && !items[endIndex].classList.contains('h-h2')) {
        endIndex += 1;
      }
      for (var i = 0; i < beginIndex; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
      for (var i = beginIndex + 1; i < endIndex; i++) {
        item = items[i]
        // if (!item.classList.contains('h-h2')) {
          item.style.display = '';
        // }
      }
      for (var i = endIndex; i < items.length; i++) {
        item = items[i]
        if (!item.classList.contains('h-h2')) {
          item.style.display = 'none';
        }
      }
    }

    // Init menu collapsed
    doMenuCollapse(-1);

    // Active the menu item
    window.addEventListener('scroll', function (event) {
      var lastActive = menuContent.querySelector('.active');
      var changed = true;
      var activeIndex = -1;
      for (var i = headings.length - 1; i >= 0; i--) {
        var h = headings[i];
        var headingRect = h.getBoundingClientRect();
        var headerRect = header.getBoundingClientRect();
        var headerTop = Math.floor(headerRect.top);
        var headerHeight = Math.floor(headerRect.height);
        var headerHeight = headerTop + headerHeight + 20;
        if (headingRect.top <= headerHeight) {
          var id = 'h-' + h.getAttribute('id');
          var a = menuContent.querySelector('a[href="#' + id  + '"]');
          var curActive = a.parentNode;
          if (curActive) {
            curActive.classList.add('active');
            activeIndex = i;
          }
          if (lastActive == curActive) {
            changed = false;
          }
          break;
        }
      }
      if (changed) {
        if (lastActive) {
          lastActive.classList.remove('active');
        }
        doMenuCollapse(activeIndex);
      }
      event.preventDefault();
    });
  }
  generateContent();
</script>
</section>
</div>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>

  <div class="wrapper">
    <div class="site-footer-inner">
<div>Unpublished Work <span class="copyleft">©</span> 2017-2024 Young Hwang</div>
      <div>Powered by <a title="Jekyll is a simple, blog-aware, static site
      generator." href="https://jekyllrb.com/">Jekyll</a> &amp; <a title="Yat, yet
      another theme." href="https://github.com/jeffreytse/jekyll-theme-yat">Yat Theme</a>.</div>
      <div class="footer-col rss-subscribe">Subscribe <a href="/feed.xml">via RSS</a>
</div>
    </div>
  </div>
</footer>
</body>
</html>
